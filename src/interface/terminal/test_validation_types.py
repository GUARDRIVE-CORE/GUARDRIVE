xt(D,K){const he=new mp;return he.scale=D||1,he.fontStack=K,he}static forImage(D){const K=new mp;return K.imageName=D,K}}class Md{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(D,K){const he=new Md;for(let Ee=0;Ee<D.sections.length;Ee++){const Be=D.sections[Ee];Be.image?he.addImageSection(Be):he.addTextSection(Be,K)}return he}length(){return this.text.length}getSection(D){return this.sections[this.sectionIndex[D]]}getSectionIndex(D){return this.sectionIndex[D]}getCharCode(D){return this.text.charCodeAt(D)}verticalizePunctuation(){this.text=function(D){let K="";for(let he=0;he<D.length;he++){const Ee=D.charCodeAt(he+1)||null,Be=D.charCodeAt(he-1)||null;K+=Ee&&ul(Ee)&&!gu[D[he+1]]||Be&&ul(Be)&&!gu[D[he-1]]||!gu[D[he]]?D[he]:gu[D[he]]}return K}(this.text)}trim(){let D=0;for(let he=0;he<this.text.length&&c0[this.text.charCodeAt(he)];he++)D++;let K=this.text.length;for(let he=this.text.length-1;he>=0&&he>=D&&c0[this.text.charCodeAt(he)];he--)K--;this.text=this.text.substring(D,K),this.sectionIndex=this.sectionIndex.slice(D,K)}substring(D,K){const he=new Md;return he.text=this.text.substring(D,K),he.sectionIndex=this.sectionIndex.slice(D,K),he.sections=this.sections,he}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((D,K)=>Math.max(D,this.sections[K].scale),0)}addTextSection(D,K){this.text+=D.text,this.sections.push(mp.forText(D.scale,D.fontStack||K));const he=this.sections.length-1;for(let Ee=0;Ee<D.text.length;++Ee)this.sectionIndex.push(he)}addImageSection(D){const K=D.image?D.image.name:"";if(K.length===0)return void m("Can't add FormattedSection with an empty image.");const he=this.getNextImageSectionCharCode();he?(this.text+=String.fromCharCode(he),this.sections.push(mp.forImage(K)),this.sectionIndex.push(this.sections.length-1)):m("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function u0(H,D,K,he,Ee,Be,Ve,nt,mt,Pt,Xt,er,br,Rr,jr){const Yr=Md.fromFeature(H,Ee);let ca;er===e.ah.vertical&&Yr.verticalizePunctuation();const{processBidirectionalText:Ca,processStyledBidirectionalText:cn}=ws;if(Ca&&Yr.sections.length===1){ca=[];const Mn=Ca(Yr.toString(),rd(Yr,Pt,Be,D,he,Rr));for(const ei of Mn){const ji=new Md;ji.text=ei,ji.sections=Yr.sections;for(let Zo=0;Zo<ei.length;Zo++)ji.sectionIndex.push(0);ca.push(ji)}}else if(cn){ca=[];const Mn=cn(Yr.text,Yr.sectionIndex,rd(Yr,Pt,Be,D,he,Rr));for(const ei of Mn){const ji=new Md;ji.text=ei[0],ji.sectionIndex=ei[1],ji.sections=Yr.sections,ca.push(ji)}}else ca=function(Mn,ei){const ji=[],Zo=Mn.text;let Xi=0;for(const Bi of ei)ji.push(Mn.substring(Xi,Bi)),Xi=Bi;return Xi<Zo.length&&ji.push(Mn.substring(Xi,Zo.length)),ji}(Yr,rd(Yr,Pt,Be,D,he,Rr));const Ga=[],rn={positionedLines:Ga,text:Yr.toString(),top:Xt[1],bottom:Xt[1],left:Xt[0],right:Xt[0],writingMode:er,iconsInText:!1,verticalizable:!1};return function(Mn,ei,ji,Zo,Xi,Bi,xo,fo,io,Fn,Mo,bo){let is=0,Ql=Sd,Zl=0,rf=0;const xh=fo==="right"?1:fo==="left"?0:.5;let Tc=0;for(const Zu of Xi){Zu.trim();const af=Zu.getMaxScale(),Jf=(af-1)*wl,Ff={positionedGlyphs:[],lineOffset:0};Mn.positionedLines[Tc]=Ff;const hh=Ff.positionedGlyphs;let Of=0;if(!Zu.length()){Ql+=Bi,++Tc;continue}for(let yu=0;yu<Zu.length();yu++){const il=Zu.getSection(yu),Dl=Zu.getSectionIndex(yu),Bl=Zu.getCharCode(yu);let Ou=0,mu=null,Dd=null,Kh=null,Jh=wl;const $f=!(io===e.ah.horizontal||!Mo&&!Go(Bl)||Mo&&(c0[Bl]||(Vc=Bl,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(Vc)))));if(il.imageName){const eu=Zo[il.imageName];if(!eu)continue;Kh=il.imageName,Mn.iconsInText=Mn.iconsInText||!0,Dd=eu.paddedRect;const Tf=eu.displaySize;il.scale=il.scale*wl/bo,mu={width:Tf[0],height:Tf[1],left:jc,top:-3,advance:$f?Tf[1]:Tf[0]},Ou=Jf+(wl-Tf[1]*il.scale),Jh=mu.advance;const Xh=$f?Tf[0]*il.scale-wl*af:Tf[1]*il.scale-wl*af;Xh>0&&Xh>Of&&(Of=Xh)}else{const eu=ji[il.fontStack],Tf=eu&&eu[Bl];if(Tf&&Tf.rect)Dd=Tf.rect,mu=Tf.metrics;else{const Xh=ei[il.fontStack],Fh=Xh&&Xh[Bl];if(!Fh)continue;mu=Fh.metrics}Ou=(af-il.scale)*wl}$f?(Mn.verticalizable=!0,hh.push({glyph:Bl,imageName:Kh,x:is,y:Ql+Ou,vertical:$f,scale:il.scale,fontStack:il.fontStack,sectionIndex:Dl,metrics:mu,rect:Dd}),is+=Jh*il.scale+Fn):(hh.push({glyph:Bl,imageName:Kh,x:is,y:Ql+Ou,vertical:$f,scale:il.scale,fontStack:il.fontStack,sectionIndex:Dl,metrics:mu,rect:Dd}),is+=mu.advance*il.scale+Fn)}hh.length!==0&&(Zl=Math.max(is-Fn,Zl),zx(hh,0,hh.length-1,xh,Of)),is=0;const zh=Bi*af+Of;Ff.lineOffset=Math.max(Of,Jf),Ql+=zh,rf=Math.max(zh,rf),++Tc}var Vc;const uh=Ql-Sd,{horizontalAlign:ch,verticalAlign:fh}=yg(xo);(function(Zu,af,Jf,Ff,hh,Of,zh,yu,il){const Dl=(af-Jf)*hh;let Bl=0;Bl=Of!==zh?-yu*Ff-Sd:(-Ff*il+.5)*zh;for(const Ou of Zu)for(const mu of Ou.positionedGlyphs)mu.x+=Dl,mu.y+=Bl})(Mn.positionedLines,xh,ch,fh,Zl,rf,Bi,uh,Xi.length),Mn.top+=-fh*uh,Mn.bottom=Mn.top+uh,Mn.left+=-ch*Zl,Mn.right=Mn.left+Zl}(rn,D,K,he,ca,Ve,nt,mt,er,Pt,br,jr),!function(Mn){for(const ei of Mn)if(ei.positionedGlyphs.length!==0)return!1;return!0}(Ga)&&rn}const c0={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Rx={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Dx={40:!0};function f0(H,D,K,he,Ee,Be){if(D.imageName){const Ve=he[D.imageName];return Ve?Ve.displaySize[0]*D.scale*wl/Be+Ee:0}{const Ve=K[D.fontStack],nt=Ve&&Ve[H];return nt?nt.metrics.advance*D.scale+Ee:0}}function om(H,D,K,he){const Ee=Math.pow(H-D,2);return he?H<D?Ee/2:2*Ee:Ee+Math.abs(K)*K}function h0(H,D,K){let he=0;return H===10&&(he-=1e4),K&&(he+=150),H!==40&&H!==65288||(he+=50),D!==41&&D!==65289||(he+=50),he}function gg(H,D,K,he,Ee,Be){let Ve=null,nt=om(D,K,Ee,Be);for(const mt of he){const Pt=om(D-mt.x,K,Ee,Be)+mt.badness;Pt<=nt&&(Ve=mt,nt=Pt)}return{index:H,x:D,priorBreak:Ve,badness:nt}}function xv(H){return H?xv(H.priorBreak).concat(H.index):[]}function rd(H,D,K,he,Ee,Be){if(!H)return[];const Ve=[],nt=function(er,br,Rr,jr,Yr,ca){let Ca=0;for(let cn=0;cn<er.length();cn++){const Ga=er.getSection(cn);Ca+=f0(er.getCharCode(cn),Ga,jr,Yr,br,ca)}return Ca/Math.max(1,Math.ceil(Ca/Rr))}(H,D,K,he,Ee,Be),mt=H.text.indexOf("â€‹")>=0;let Pt=0;for(let er=0;er<H.length();er++){const br=H.getSection(er),Rr=H.getCharCode(er);if(c0[Rr]||(Pt+=f0(Rr,br,he,Ee,D,Be)),er<H.length()-1){const jr=!((Xt=Rr)<11904)&&(!!Sn["CJK Compatibility Forms"](Xt)||!!Sn["CJK Compatibility"](Xt)||!!Sn["CJK Strokes"](Xt)||!!Sn["CJK Symbols and Punctuation"](Xt)||!!Sn["Enclosed CJK Letters and Months"](Xt)||!!Sn["Halfwidth and Fullwidth Forms"](Xt)||!!Sn["Ideographic Description Characters"](Xt)||!!Sn["Vertical Forms"](Xt)||Ls.test(String.fromCodePoint(Xt)));(Rx[Rr]||jr||br.imageName||er!==H.length()-2&&Dx[H.getCharCode(er+1)])&&Ve.push(gg(er+1,Pt,nt,Ve,h0(Rr,H.getCharCode(er+1),jr&&mt),!1))}}var Xt;return xv(gg(H.length(),Pt,nt,Ve,0,!0))}function yg(H){let D=.5,K=.5;switch(H){case"right":case"top-right":case"bottom-right":D=1;break;case"left":case"top-left":case"bottom-left":D=0}switch(H){case"bottom":case"bottom-right":case"bottom-left":K=1;break;case"top":case"top-right":case"top-left":K=0}return{horizontalAlign:D,verticalAlign:K}}function zx(H,D,K,he,Ee){if(!he&&!Ee)return;const Be=H[K],Ve=(H[K].x+Be.metrics.advance*Be.scale)*he;for(let nt=D;nt<=K;nt++)H[nt].x-=Ve,H[nt].y+=Ee}function Fx(H,D,K){const{horizontalAlign:he,verticalAlign:Ee}=yg(K),Be=D[0]-H.displaySize[0]*he,Ve=D[1]-H.displaySize[1]*Ee;return{image:H,top:Ve,bottom:Ve+H.displaySize[1],left:Be,right:Be+H.displaySize[0]}}function sm(H){var D,K;let he=H.left,Ee=H.top,Be=H.right-he,Ve=H.bottom-Ee;const nt=(D=H.image.textFitWidth)!==null&&D!==void 0?D:"stretchOrShrink",mt=(K=H.image.textFitHeight)!==null&&K!==void 0?K:"stretchOrShrink",Pt=(H.image.content[2]-H.image.content[0])/(H.image.content[3]-H.image.content[1]);if(mt==="proportional"){if(nt==="stretchOnly"&&Be/Ve<Pt||nt==="proportional"){const Xt=Math.ceil(Ve*Pt);he*=Xt/Be,Be=Xt}}else if(nt==="proportional"&&mt==="stretchOnly"&&Pt!==0&&Be/Ve>Pt){const Xt=Math.ceil(Be/Pt);Ee*=Xt/Ve,Ve=Xt}return{x1:he,y1:Ee,x2:he+Be,y2:Ee+Ve}}function lm(H,D,K,he,Ee,Be){const Ve=H.image;let nt;if(Ve.content){const ca=Ve.content,Ca=Ve.pixelRatio||1;nt=[ca[0]/Ca,ca[1]/Ca,Ve.displaySize[0]-ca[2]/Ca,Ve.displaySize[1]-ca[3]/Ca]}const mt=D.left*Be,Pt=D.right*Be;let Xt,er,br,Rr;K==="width"||K==="both"?(Rr=Ee[0]+mt-he[3],er=Ee[0]+Pt+he[1]):(Rr=Ee[0]+(mt+Pt-Ve.displaySize[0])/2,er=Rr+Ve.displaySize[0]);const jr=D.top*Be,Yr=D.bottom*Be;return K==="height"||K==="both"?(Xt=Ee[1]+jr-he[0],br=Ee[1]+Yr+he[2]):(Xt=Ee[1]+(jr